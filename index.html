<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario por Serie - Evelyn</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f0f2f5; padding: 10px; color: #333; }
        .container { max-width: 900px; margin: auto; display: flex; flex-wrap: wrap; gap: 20px; }
        .form-caja { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 350px; }
        input, textarea { width: 90%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        .btn-save { background: #1a73e8; color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .tabla-caja { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); flex: 1; min-width: 300px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: #202124; color: white; border-radius: 4px; }
        .serie-badge { background: #e8f0fe; color: #1a73e8; padding: 4px 8px; border-radius: 4px; font-family: monospace; font-weight: bold; }
        .btn-edit { background: #fbbc04; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        .btn-del { background: #ea4335; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .etiqueta-final { display: none; margin-top: 20px; padding: 15px; border: 2px solid #000; background: white; text-align: center; }
        @media print { body * { visibility: hidden; } .etiqueta-final, .etiqueta-final * { visibility: visible; } .etiqueta-final { position: absolute; left: 0; top: 0; width: 100%; border: none; } }
    </style>
</head>
<body>

    <h1>üì¶ Control de Inventario por Serie</h1>

    <div class="container">
        <div class="form-caja">
            <h3 id="titulo-form">Nuevo Componente</h3>
            <input type="hidden" id="edit-id" value="-1">
            <label>Nombre del Componente:</label>
            <input type="text" id="nombre" placeholder="Ej: Resistor SMD 0805">
            <label>Valor:</label>
            <input type="text" id="valor" placeholder="Ej: 10k Ohm">
            <label>Cantidad en Stock:</label>
            <input type="number" id="cantidad" placeholder="0">
            <label>Descripci√≥n / Ubicaci√≥n:</label>
            <textarea id="desc" rows="2" placeholder="Ej: Caj√≥n A-1"></textarea>
            <button class="btn-save" onclick="procesarDatos()">GUARDAR EN INVENTARIO</button>

            <div id="print-area" class="etiqueta-final">
                <p style="font-size: 12px; margin: 0;">SERIE DE ALMACENAMIENTO</p>
                <h2 id="serie-txt" style="margin: 5px 0; font-size: 30px; letter-spacing: 2px;"></h2>
                <p id="detalles-txt" style="margin: 0; border-top: 1px solid #000; padding-top: 5px;"></p>
                <button onclick="window.print()" style="margin-top: 10px; cursor: pointer;">Imprimir Etiqueta</button>
            </div>
        </div>

        <div class="tabla-caja">
            <h3>Inventario Guardado</h3>
            <table>
                <thead>
                    <tr>
                        <th>Serie</th>
                        <th>Componente</th>
                        <th>Cant.</th>
                        <th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody id="cuerpo-tabla"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Cargar datos guardados al iniciar
        var stock = JSON.parse(localStorage.getItem('inventario_smd_v6') || '[]');
        actualizarTabla();

        function procesarDatos() {
            var nom = document.getElementById('nombre').value;
            var val = document.getElementById('valor').value;
            var can = document.getElementById('cantidad').value;
            var des = document.getElementById('desc').value;
            var id = document.getElementById('edit-id').value;

            if(!nom || !val || !can) { alert("Completa Nombre, Valor y Cantidad"); return; }

            if(id === "-1") {
                // Generar serie nueva basada en el tiempo para que sea √∫nica
                var serie = "SN-" + Math.floor(1000 + Math.random() * 9000);
                stock.push({ serie: serie, nombre: nom, valor: val, cantidad: can, desc: des });
            } else {
                // Editar existente
                stock[id].nombre = nom;
                stock[id].valor = val;
                stock[id].cantidad = can;
                stock[id].desc = des;
                document.getElementById('edit-id').value = "-1";
                document.getElementById('titulo-form').innerText = "Nuevo Componente";
            }

            localStorage.setItem('inventario_smd_v6', JSON.stringify(stock));
            actualizarTabla();
            mostrarEtiqueta(stock[stock.length - 1]);
            limpiar();
        }

        function actualizarTabla() {
            var tabla = document.getElementById('cuerpo-tabla');
            tabla.innerHTML = "";
            stock.forEach(function(item, i) {
                tabla.innerHTML += "<tr>" +
                    "<td><span class='serie-badge'>" + item.serie + "</span></td>" +
                    "<td>" + item.nombre + " (" + item.valor + ")</td>" +
                    "<td><b>" + item.cantidad + "</b></td>" +
                    "<td>" +
                        "<button class='btn-edit' onclick='cargarEdit("+i+")'>üìù</button>" +
                        "<button class='btn-del' onclick='eliminar("+i+")'>üóëÔ∏è</button>" +
                    "</td></tr>";
            });
        }

        function mostrarEtiqueta(item) {
            document.getElementById('print-area').style.display = 'block';
            document.getElementById('serie-txt').innerText = item.serie;
            document.getElementById('detalles-txt').innerText = item.nombre + " | " + item.valor;
        }

        function cargarEdit(i) {
            var item = stock[i];
            document.getElementById('nombre').value = item.nombre;
            document.getElementById('valor').value = item.valor;
            document.getElementById('cantidad').value = item.cantidad;
            document.getElementById('desc').value = item.desc;
            document.getElementById('edit-id').value = i;
            document.getElementById('titulo-form').innerText = "Editando Serie: " + item.serie;
            window.scrollTo(0,0);
        }

        function eliminar(i) {
            if(confirm("¬øSeguro que quieres borrar este componente?")) {
                stock.splice(i, 1);
                localStorage.setItem('inventario_smd_v6', JSON.stringify(stock));
                actualizarTabla();
            }
        }

        function limpiar() {
            document.getElementById('nombre').value = "";
            document.getElementById('valor').value = "";
            document.getElementById('cantidad').value = "";
            document.getElementById('desc').value = "";
        }
    </script>
</body>
</html>
            
